<!DOCTYPE html>
  
  
  
  
   <html class="no-js"> 

  <head lang="en-us">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,user-scalable=no,initial-scale=1,maximum-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=10" />
    <title>Intrinsic Calibration - PennCOSYVIO Data Set</title>
    <meta name="generator" content="Hugo 0.16-DEV" />

    
    <meta name="description" content="A data set for Visual Inertial Odometry.">
    
    <link rel="canonical" href="https://daniilidis-group.github.io/penncosyvio/intrinsic_calib/">
    
    <meta name="author" content="Bernd Pfrommer">
    

    <meta property="og:url" content="https://daniilidis-group.github.io/penncosyvio/intrinsic_calib/">
    <meta property="og:title" content="PennCOSYVIO Data Set">
    <meta property="og:image" content="https://daniilidis-group.github.io/penncosyvio/upenn_favicon.jpg">
    <meta name="apple-mobile-web-app-title" content="PennCOSYVIO Data Set">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

    <link rel="shortcut icon" type="image/x-icon" href="https://daniilidis-group.github.io/penncosyvio/upenn_favicon.jpg">
    <link rel="icon" type="image/x-icon" href="https://daniilidis-group.github.io/penncosyvio/upenn_favicon.jpg">

    <style>
      @font-face {
        font-family: 'Icon';
        src: url('https://daniilidis-group.github.io/penncosyvio/fonts/icon.eot?52m981');
        src: url('https://daniilidis-group.github.io/penncosyvio/fonts/icon.eot?#iefix52m981')
               format('embedded-opentype'),
             url('https://daniilidis-group.github.io/penncosyvio/fonts/icon.woff?52m981')
               format('woff'),
             url('https://daniilidis-group.github.io/penncosyvio/fonts/icon.ttf?52m981')
               format('truetype'),
             url('https://daniilidis-group.github.io/penncosyvio/fonts/icon.svg?52m981#icon')
               format('svg');
        font-weight: normal;
        font-style: normal;
      }
    </style>

    <link rel="stylesheet" href="https://daniilidis-group.github.io/penncosyvio/stylesheets/application.css">
    <link rel="stylesheet" href="https://daniilidis-group.github.io/penncosyvio/stylesheets/temporary.css">
    <link rel="stylesheet" href="https://daniilidis-group.github.io/penncosyvio/stylesheets/palettes.css">
    <link rel="stylesheet" href="https://daniilidis-group.github.io/penncosyvio/stylesheets/highlight/highlight.css">

    
    
    
    <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Ubuntu:400,700|Ubuntu&#43;Mono">
    <style>
      body, input {
        font-family: 'Ubuntu', Helvetica, Arial, sans-serif;
      }
      pre, code {
        font-family: 'Ubuntu Mono', 'Courier New', 'Courier', monospace;
      }
    </style>

    
    <link rel="stylesheet" href="https://daniilidis-group.github.io/penncosyvio/tweaks.css">
    
    <script src="https://daniilidis-group.github.io/penncosyvio/javascripts/modernizr.js"></script>
    <script type="text/javascript"
	    src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
    </script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  jax: ["input/TeX", "output/HTML-CSS"],
  tex2jax: {
    inlineMath: [ ['$', '$'] ],
    displayMath: [ ['$$', '$$']],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  },
  messageStyle: "none",
  "HTML-CSS": { 
      preferredFont: "TeX", 
      availableFonts: ["STIX","TeX"], 
      styles: {".MathJax": {color: "#000 !important"}} 
      }
});
</script>
$
\newcommand{\cc}[1]{\color{black}{#1}}
\newcommand{\mvec}[1]{\mathbf{#1}}
\newcommand{\cvec}[2]{^\mathrm{#2}\mathbf{#1}}
\newcommand{\ctrans}[3]{^\mathrm{#3}\mathbf{#1}_\mathrm{#2}}
\newcommand{\rmat}[9]{\cc{\begin{bmatrix}{#1}&{#2}&{#3}\\\ {#4}&{#5}&{#6}\\\ {#7}&{#8}&{#9}\end{bmatrix}}}
\newcommand{\hmat}[3]{\cc{\begin{bmatrix}{#1}\\\ {#2}\\\ {#3}\\\ \end{bmatrix}}}
\newcommand{\mq}[4]{\cc{\begin{bmatrix}{#1}&{#2}&{#3}&{#4}\\\ \end{bmatrix}}}
\newcommand{\nvec}[3]{\cc{\begin{bmatrix}{#1}&{#2}&{#3}\\\ \end{bmatrix}}}
\newcommand{\vvec}[3]{\cc{\begin{bmatrix}{#1}\\\ {#2}\\\ {#3}\end{bmatrix}}}
\newcommand{\vvt}[2]{\cc{\begin{bmatrix}{#1}\\\ {#2}\end{bmatrix}}}
\newcommand{\calmat}[4]{\cc{\begin{bmatrix}{#1}&0&{#3}\\\ 0&{#2}&{#4}\end{bmatrix}}}
\newcommand{\dp}{^{\prime\prime}}
$

    

  </head>
  <body class="palette-primary-blue palette-accent-light-green">




<div class="backdrop">
	<div class="backdrop-paper"></div>
</div>

<input class="toggle" type="checkbox" id="toggle-drawer">
<input class="toggle" type="checkbox" id="toggle-search">
<label class="toggle-button overlay" for="toggle-drawer"></label>

<header class="header">
	<nav aria-label="Header">
  <div class="bar default">
    <div class="button button-menu" role="button" aria-label="Menu">
      <label class="toggle-button icon icon-menu" for="toggle-drawer">
        <span></span>
      </label>
    </div>
    <div class="headtitle">
    <div class="stretch">
      <div class="title">
        Intrinsic Calibration
      </div>
    </div>
    </div>

    

    
    <div class="button button-github" role="button" aria-label="GitHub">
      <a href="https://github.com/berndpfrommer" title="@berndpfrommer on GitHub" target="_blank" class="toggle-button icon icon-github"></a>
    </div>
    
    
        
  </div>
  <div class="bar search">
    <div class="button button-close" role="button" aria-label="Close">
      <label class="toggle-button icon icon-back" for="toggle-search"></label>
    </div>
    <div class="stretch">
      <div class="field">
        <input class="query" type="text" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck>
      </div>
    </div>
    <div class="button button-reset" role="button" aria-label="Search">
      <button class="toggle-button icon icon-close" id="reset-search"></button>
    </div>
  </div>
</nav>

</header>

<main class="main">
	<div class="drawer">
		<nav aria-label="Navigation">
  <a href="https://daniilidis-group.github.io/penncosyvio/" class="project">
    <div class="banner">
      
        <div class="logo">
          <img src="https://daniilidis-group.github.io/penncosyvio/upenn_favicon.jpg">
        </div>
      
      <div class="name">
        <strong>PennCOSYVIO Data Set </strong>
        
      </div>
    </div>
  </a>

  <div class="scrollable">
    <div class="wrapper">
      

      <div class="toc">
        
        <ul>
          




<li>
  
    



<a  title="Overview" href="https://daniilidis-group.github.io/penncosyvio/">
	
	Overview
</a>


  
</li>



<li>
  
    



<a  title="Download" href="https://daniilidis-group.github.io/penncosyvio/download/">
	
	Download
</a>


  
</li>



<li>
  
    



<a class="current" title="Intrinsic Calibration" href="https://daniilidis-group.github.io/penncosyvio/intrinsic_calib/">
	
	Intrinsic Calibration
</a>


<ul id="scrollspy">
</ul>

  
</li>



<li>
  
    



<a  title="Extrinsic Calibration" href="https://daniilidis-group.github.io/penncosyvio/extrinsic_calib/">
	
	Extrinsic Calibration
</a>


  
</li>


        </ul>
        

        
        <hr>
        <span class="section">The author</span>
        
        <ul>
          

          
          <li>
            <a href="https://github.com/berndpfrommer" target="_blank" title="@berndpfrommer on GitHub">
              @berndpfrommer on GitHub
            </a>
          </li>
          
        </ul>
        
      </div>
    </div>
  </div>
</nav>

	</div>

	<article class="article">
		<div class="wrapper">
			<h1>Intrinsic Calibration </h1>

			

<p>Two different models were used for the intrinsic calibration of the cameras:</p>

<ul>
<li><a href="http://www.mathworks.com/help/vision/ug/camera-calibration.html">standard perspective</a>
model with two radial distortion distortion coefficients.
This model works well for the Tango Bottom RGB camera and the VI sensor cameras</li>
<li><a href="https://sites.google.com/site/scarabotix/ocamcalib-toolbox">omnidirectional model</a> for
the GoPro cameras and the Tango Top. This is necessary to accurately
model the wide-angle lenses projection function all the way to the corners of the sensor.</li>
</ul>

<p>A square chessboard calibration target of 7x8 was used with square
length of 108mm. The images were cut from video, and are available
under the <code>intrinsic_calibration</code> directory (requires separate download).</p>

<h2 id="how-to-use-the-calibration-models">How to Use the Calibration Models</h2>

<p>The camera calibration models are stored under <code>dev/intrinsic_calibration/cc.mat</code> and can be loaded
in Matlab like this:</p>

<pre><code>&gt;&gt; cd dev/matlab;
&gt;&gt; load ../intrinsic_calibration/cc.mat
&gt;&gt; cc

cc = 

    [1x1 struct]    [1x1 struct]    [1x1 struct]    [1x1 cameraParameters]    [1x1 struct]    [1x1 cameraParameters]    [1x1 cameraParameters]
</code></pre>

<p>The <code>cc</code> cell array has the cameras in the order:
<table>
<tr><td>1</td><td>2</td><td>3</td><td>4</td><td>5</td><td>6</td><td>7</td></tr>
<tr><td>GoPro C1</td><td>GoPro C2</td><td> GoPro C3</td><td> Tango Bottom</td><td> Tango Top</td><td>VI Sensor Left</td><td>VI Sensor Right</td></tr>
</table></p>

<h3 id="undistorting-tango-bottom-and-vi-sensor-images">Undistorting Tango Bottom and VI Sensor images</h3>

<p>To undistort images for Tango Bottom&rsquo;s RGB camera or the VI Sensors, you can directly use the Matlab <code>undistortImage</code> function. The following matlab
line would read an image, undistort it with the Tango Bottom calibration parameters, and display it:</p>

<pre><code>&gt;&gt; imtool(undistortImage(imread('foo.jpg'),cc{4}));
</code></pre>

<h3 id="undistorting-gopro-and-tango-top-images">Undistorting GoPro and Tango Top Images</h3>

<p>Images taken with the fisheye lenses require the use of a custom undistortion matlab function for undistortion.
Undistortion is a two-step process: first a undistortion map is
pre-computed (this needs to be done only once per camera),
which then is used to perform the actual undistortion. For example, this would be the steps to undistort an image
for GoPro camera C1:</p>

<pre><code>&gt;&gt; u = ocam_undistort_map(cc{1}, 'OutputView', 'full');
&gt;&gt; imtool(ocam_undistort(imread('../../intrinsic_calibration/c1/frame_0011.png'), u));
</code></pre>

<table>
<tr>
<td><img alt="distorted original" src="../pics/intcalib/c1_dist.jpg"></td>
<td><img alt="undistorted" src="../pics/intcalib/c1_undist.jpg"></td>
</tr>
</table>

<p>For more undistortion options, see <code>help ocam_undistort_map</code>. In
particular setting <code>OutputView</code> to <code>same</code> is a useful choice, but you
can also increase the resolution to reduce quality loss during
undistort. Note that the intrinsic matrix $\mvec{K}$ depends on the undistortion
mode used, and is in fact a field of the undistortion structure:</p>

<pre><code>&gt;&gt; u
u = 
    map: [2073600x2 double]
      K: [3x3 double]
    res: [1920 1080]
&gt;&gt; u.K'
ans =
          472.402621799665                         0          958.773771858922
                         0          476.268511742695          539.250755510546
                         0                         0                         1
</code></pre>

<p>If instead <code>OutputView</code> <code>same</code> is used, the focal lengths will increase substantially!</p>

<h2 id="matlab-toolbox-tango-bottom-and-vi-sensors">Matlab Toolbox: Tango Bottom and VI Sensors</h2>

<p>We use Matlab&rsquo;s built-in camera calibration tool, which uses the
camera model proposed by <a href="http://www.vision.caltech.edu/bouguetj/calib_doc/" title="Bouguet, J. Y.: Camera Calibration Toolbox for Matlab. Computational Vision at the California Institute of Technology.">Bouguet</a> for the CalTec Camera Calibration
Toolbox. The model consists of a perspective projection followed by a
radial distortion. For parsimony, we did not allow for skew or
tangential distortion, and limited the number of radial distortion
coefficients to two. This leads to the following model: the 3D point
$\cc{\cvec{X}{W}}$ in world coordinates is first transformed to the camera
frame by the current camera pose $\cc{\ctrans{T}{W}{C}}$:
$$
\cc{\vvec{x}{y}{z}=\ \cvec{X}{C}=\ \ctrans{T}{W}{C}\ \cvec{X}{W}}.
$$
Then, the projected 2D coordinates are obtained via:
$$
\cc{\vvt{x&rsquo;}{y&rsquo;} =\ \vvt{x/z}{y/z}}.
$$
Now the radial distortion is captured by:
$$
\cc{\vvt{x\dp}{y\dp} =\ \vvt{x&rsquo;(1+k_1r&rsquo;^2 +k_2r&rsquo;^4)}{y&rsquo;(1+k_1r&rsquo;^2 +k_2r&rsquo;^4)}},
$$
where $\cc{r&rsquo;^2 = x&rsquo;^2 + y&rsquo;^2}$. Lastly, using the intrinsic matrix yields the sensor pixel coordinates:
$$
\cc{\vvt{u}{v} = \begin{bmatrix}f_x &amp; 0 &amp; c_x\\ 0 &amp; f_y &amp; c_y\end{bmatrix}\vvec{x\dp}{y\dp}{1}}.
$$</p>

<p>Note that the camera models as stored in the Matlab cell array (see <a href="#foo">above</a>) follow
Matlab convention, so their intrinsic matrix is transposed compared to the table below!
The VI sensor calibration is based off the rectified images (this explains why the radial distortion is virtually zero),
and is therefore the correct calibration to use for the rectified video frames in the ROS bag.</p>

<table>
<tr>
<td>Camera</td><td>$\cc{\begin{bmatrix}f_x & 0 & c_x\\\ 0 & f_y & c_y\end{bmatrix}}$</td><td>$\cc{k_1}$</td><td>$\cc{k_2}$</td>
</tr>
<tr><td>Tango Bottom RGB</td><td>$\cc{\calmat{   1959.84}{   1959.39}{    981.87}{    524.94}}$</td><td> 0.21253</td><td>-0.46023</td></tr>
<tr><td>VI Sensor Left</td><td>$\cc{\calmat{    445.80}{    445.15}{    371.50}{    237.33}}$</td><td>-0.03671</td><td> 0.05260</td></tr>
<tr><td>VI Sensor Right</td><td>$\cc{\calmat{    445.75}{    445.23}{    369.28}{    238.72}}$</td><td>-0.03427</td><td> 0.04858</td></tr>
</table>

<h2 id="fisheye-intrinsic-calibration-using-ocamcalib-toolbox">Fisheye Intrinsic Calibration using OCamCalib Toolbox</h2>

<p>We used the <a href="https://sites.google.com/site/scarabotix/ocamcalib-toolbox/" title="Scaramuzza, D: OCamCalib: Omnidirectional Camera Calibration Toolbox for Matlab.">OCamCalib Toolbox</a> (version 3.0) to fit a 4-parameter
polynomial to the forward projection function. The image center was
held fixed for parsimony, and because good results (less than 1px
average reprojection error) were obtained already without allowing the
center to float.</p>

<p>Here the forward projection function of the GoPro Hero 4 camera
C2. Note that the horizontal FOV is twice the angle covered in the
graph (which is about 60 degrees).</p>

<p><img src="../pics/intcalib/c2_projfun.jpg" alt="forward projection function" /></p>

<p>Here a graphical illustration of the different extrinsic positions that
were assumed, showing that we took images with the calibration target as
far in the corner as possible:
<img src="../pics/intcalib/c2_ext.jpg" alt="external calibration positions" /></p>

<p>These are the calibration parameters obtained from the toolbox. Refer
to <a href="https://sites.google.com/site/scarabotix/ocamcalib-toolbox/" title="Scaramuzza, D: OCamCalib: Omnidirectional Camera Calibration Toolbox for Matlab.">2</a> for description of the parameters and the camera model:</p>

<table>
<tr><td>Camera</td><td>width</td><td>height</td><td>xc</td><td>yc</td><td>c</td><td>d</td><td>e</td><td>ss [polynomial coefficients]</td></tr>
<tr><td>GoPro C1</td><td>1920</td><td>1080</td><td>539.9</td><td>959.9</td><td>1.008</td><td>2.710e-04</td><td>-3.229e-04</td><td>$\cc{\begin{bmatrix}-867.43&0.000000&3.1130e-04&5.1424e-08&-3.3722e-11\end{bmatrix}}$</td></tr>
<tr><td>GoPro C2</td><td>1920</td><td>1080</td><td>539.9</td><td>959.9</td><td>1.004</td><td>-4.473e-04</td><td>-1.378e-03</td><td>$\cc{\begin{bmatrix}-877.47&0.000000&3.3388e-04&-9.2419e-09&1.1041e-11\end{bmatrix}}$</td></tr>
<tr><td>GoPro C3</td><td>1920</td><td>1080</td><td>539.9</td><td>959.9</td><td>1.006</td><td>1.794e-04</td><td>-8.563e-04</td><td>$\cc{\begin{bmatrix}-875.98&0.000000&3.3576e-04&-3.0754e-08&2.8774e-11\end{bmatrix}}$</td></tr>
<tr><td>Tango Top Fisheye</td><td>640</td><td>480</td><td>240.0</td><td>320.0</td><td>1.000</td><td>4.162e-04</td><td>1.303e-04</td><td>$\cc{\begin{bmatrix}-273.59&0.000000&1.2923e-03&-8.7901e-07&2.7410e-09\end{bmatrix}}$</td></tr>
</table>


			<footer class="footer">
				

<nav class="pagination" aria-label="Footer">
  <div class="previous">
  
      <a href="https://daniilidis-group.github.io/penncosyvio/download/" title="Download">
        <span class="direction">
          Previous
        </span>
        <div class="page">
          <div class="button button-previous" role="button" aria-label="Previous">
            <i class="icon icon-back"></i>
          </div>
          <div class="stretch">
            <div class="title">
              Download
            </div>
          </div>
        </div>
      </a>
  
  </div>

  <div class="next">
  
      <a href="https://daniilidis-group.github.io/penncosyvio/extrinsic_calib/" title="Extrinsic Calibration">
        <span class="direction">
          Next
        </span>
        <div class="page">
          <div class="stretch">
            <div class="title">
              Extrinsic Calibration
            </div>
          </div>
          <div class="button button-next" role="button" aria-label="Next">
            <i class="icon icon-forward"></i>
          </div>
        </div>
      </a>
  
  </div>
</nav>





			</footer>
		</div>
	</article>

	<div class="results" role="status" aria-live="polite">
		<div class="scrollable">
			<div class="wrapper">
				<div class="meta"></div>
				<div class="list"></div>
			</div>
		</div>
	</div>
</main>

    <script>
    
      var base_url = '';
      var repo_id  = '';
    
    </script>

    <script src="https://daniilidis-group.github.io/penncosyvio/javascripts/application.js"></script>
    

    <script>
      /* Add headers to scrollspy */
      var headers   = document.getElementsByTagName("h2");
      var scrollspy = document.getElementById('scrollspy');

      if(scrollspy) {
        if(headers.length > 0) {
          for(var i = 0; i < headers.length; i++) {
            var li = document.createElement("li");
            li.setAttribute("class", "anchor");

            var a  = document.createElement("a");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", headers[i].innerHTML);
            a.innerHTML = headers[i].innerHTML;
            
            li.appendChild(a)
            scrollspy.appendChild(li);
          }
        } else {
          scrollspy.parentElement.removeChild(scrollspy)
        }
        

        /* Add permanent link next to the headers */
        var headers = document.querySelectorAll("h1, h2, h3, h4, h5, h6");

        for(var i = 0; i < headers.length; i++) {
            var a = document.createElement("a");
            a.setAttribute("class", "headerlink");
            a.setAttribute("href", "#" + headers[i].id);
            a.setAttribute("title", "Permanent link")
            a.innerHTML = "#";
            headers[i].appendChild(a);
        }
      }
    </script>

    

    <script src="//gohugo.io/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
  </body>
</html>
